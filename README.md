# Тестовое задание для Digital Chief
___
#### Данное приложение представляет собой имитацию блога, в котором можно добавлять пользователей, создавать посты и оставлять к ним комментарии
___
## Стэк технологий:
- Java 17
- Spring Boot 3.0.5
- Maven
- Hibernate
- Lombok
- PostgreSQL
- Docker
___
## Реализованные функции
## Пользователи:
___
- ### Добавление пользователей
#### Эндпоинт: метод POST /users
#### Используется валидация данных:
- Имя(name) не может быть null и должно содержать от 2 до 30 символов.(Код ошибки 400 BAD REQUEST)
- Фамилия(surname) не может быть null и должна содержать от 2 до 50 символов.(Код ошибки 400 BAD REQUEST)
- Email не может быть null, должен быть корректным, содержать от 2 до 100 символов и быть уникальным.(При ошибке валидации код 400 BAD REQUEST, при дублировании email 409 CONFLICT)
- Возраст(age) не может быть null, отрицательным и имеет верхнюю границу(120).(Код ошибки 400 BAD REQUEST)
- Пол(gender) не может быть null и должен быть одним из: MALE, FEMALE или UNSPECIFIED.(Код ошибки 400 BAD REQUEST)
#### Пример JSON для добавления пользователя:
````
{
    "name": "Сергей",
    "surname": "Кашковский",
    "email": "e5k4p3@gmail.com",
    "age": 27,
    "gender": "MALE"
}
````
#### Пример возвращаемого JSON:
````
{
    "id": 1,
    "name": "Сергей",
    "surname": "Кашковский",
    "email": "e5k4p3@gmail.com",
    "age": 27,
    "gender": "MALE"
}
````
___
- ### Изменение данных пользователя
#### Эндпоинт: метод PATCH /users/{id пользователя}
- Используется хэдер X-Requester-Id для проверки отправителя запроса
#### Изменить можно любое поле, кроме возраста и используется валидация, как при добавлении пользователя
#### Изменить пользователя может только он сам, например, если пользователь с id 1 попробует изменить пользователя с id 2, то вернется ошибка 403 FORBIDDEN
#### Если пользователь не найден, то вренется ошибка 404 NOT FOUND
#### Пример JSON для изменения пользователя:
````
{
    "name": "Новое имя"
    "surname": "Новая фамилия"
}
````
#### Пример возвращаемого JSON:
````
{
    "id": 1,
    "name": "Новое имя",
    "surname": "Новая фамилия",
    "email": "e5k4p3@gmail.com",
    "age": 27,
    "gender": "MALE"
}
````
___
- ### Удаление пользователя по id
#### Эндпоинт: метод DELETE /users/{id пользователя}
- Используется хэдер X-Requester-Id для проверки отправителя запроса
#### Удалить пользователя может только он сам, иначе вернется ошибка 403 FORBIDDEN
#### Если пользователь не найден, то вренется ошибка 404 NOT FOUND
#### Данный эндпоинт при успешном удалении возвращает только код 204 NO CONTENT
___
- ### Получение пользователя по id
#### Эндпоинт: метод GET /users/{id пользователя}
#### Если пользователь не найден, то вренется ошибка 404 NOT FOUND
#### Пример возвращаемого JSON:
````
{
    "id": 1,
    "name": "Сергей",
    "surname": "Кашковский",
    "email": "e5k4p3@gmail.com",
    "age": 27,
    "gender": "MALE"
}
````
___
- ### Получение всех пользователей
#### Эндпоинт: метод GET /users
- Параметры запроса:
- - from, не является обязательным, значение по умолчанию 0, используется для пагинации
- - size, не является обязательным, значение по умолчанию 10, используется для пагинации
#### Пример возвращаемого JSON:
````
[
    {
        "id": 1,
        "name": "Сергей",
        "surname": "Кашковский",
        "email": "e5k4p3@gmail.com",
        "age": 27,
        "gender": "MALE"
    },
    {
        "id": 2,
        "name": "Имя второго пользователя",
        "surname": "Фамилия второго пользователя",
        "email": "second@gmail.com",
        "age": 40,
        "gender": "FEMALE"
    }
]
````
___
## Посты:
___
- ### Добавление постов
#### Эндпоинт: метод POST /posts
-  Используется хэдер X-Requester-Id для проверки отправителя запроса и присвоения посту автора
#### Используется валидация данных:
- Название поста(title) не может быть null и должно содержать от 10 до 200 символов(Код ошибки 400 BAD REQUEST)
- Содержание поста(content) не может быть null и должно содержать от 20 до 10000 символов(Код ошибки 400 BAD REQUEST)
#### Если отправитель запроса не найден, то вернется ошибка 404 NOT FOUND
#### Пример JSON для добавления поста:
````
{
    "title": "Название поста",
    "content": "Содержание тестового поста"
}
````
#### Пример возвращаемого JSON:
````
{
    "id": 1,
    "title": "Название поста",
    "content": "Содержание тестового поста",
    "author": {
        "id": 1,
        "name": "Сергей",
        "surname": "Кашковский"
    },
    "comments": [],
    "created": "2023-04-10T19:12:04.765182429",
    "edited": false,
    "views": 0
}
````
___
- ### Изменение постов
#### Эндпоинт: метод PATCH /posts/{id поста}
- Используется хэдер X-Requester-Id для проверки отправителя запроса и автора поста
#### Если отправитель запроса или пост не найдены, то вернется ошибка 404 NOT FOUND
#### Изменить пост может только его автор, иначе вернется ошибка 403 FORBIDDEN
#### Изменить можно название(title) и содержание(content) поста
#### Используется валидация данных как и при создании поста
#### После изменения поста, поле edited меняет значение на true
#### Пример JSON при измении поста:
````
{
    "title": "Новое название поста"
}
````
#### Пример возвращаемого JSON:
````
{
    "id": 1,
    "title": "Новое название поста",
    "content": "Содержание тестового поста",
    "author": {
        "id": 1,
        "name": "Сергей",
        "surname": "Кашковский"
    },
    "comments": [],
    "created": "2023-04-10T19:12:04.765182",
    "edited": true,
    "views": 0
}
````
___
- ### Удаление постов
#### Эндпоинт: метод DELETE /posts/{id поста}
- Используется хэдер X-Requester-Id для проверки отправителя запроса и автора поста
#### Если отправитель запроса или пост не найдены, то вернется ошибка 404 NOT FOUND
#### Удалить пост может только его автор, иначе вернется ошибка 403 FORBIDDEN
#### Данный эндпоинт при успешном удалении возвращает только код 204 NO CONTENT
___
- ### Получение поста по id
#### Эндпоинт: метод GET /posts/{id поста}
#### Если пост не найден, то вернется ошибка 404 NOT FOUND
#### При получении поста, у него увеличивается счетчик просмотров(views) на 1
#### Пример возвращаемого JSON:
````
{
    "id": 1,
    "title": "Название поста",
    "content": "Содержание тестового поста",
    "author": {
        "id": 1,
        "name": "Сергей",
        "surname": "Кашковский"
    },
    "comments": [],
    "created": "2023-04-10T19:12:04.765182429",
    "edited": false,
    "views": 1
}
````
___
- ### Получение всех постов без фильтров
#### Эндпоинт: метод GET /posts
#### При получении постов, у них увеличивается счетчик просмотров(views) на 1
#### Сортировка полученных постов зависит от просмотров(по убыванию)
#### Пример возвращаемого JSON:
````
[
    {
        "id": 2,
        "title": "Название второго поста",
        "content": "Содержание второго тестового поста",
        "author": {
            "id": 2,
            "name": "Имя второго пользователя",
            "surname": "Фамилия второго пользователя"
        },
        "comments": [],
        "created": "2023-04-10T19:48:14.733182",
        "edited": false,
        "views": 3
    },
    {
        "id": 1,
        "title": "Название поста",
        "content": "Содержание тестового поста",
        "author": {
            "id": 1,
            "name": "Сергей",
            "surname": "Кашковский"
        },
        "comments": [],
        "created": "2023-04-10T19:12:04.765182",
        "edited": false,
        "views": 1
    }
]
````
___
- ### Получение всех постов с фильтрами
#### Эндпоинт: метод GET /posts/filters
- Параметры запроса:
- - text, не является обязательным, используется для поиска постов по тексту(в названии или содержании)
- - authors, не является обязательным, может иметь несколько значений и используется для поиска постов с определенными авторами
- - sort, не является обязательныс, значение по умолчанию VIEWS, используется для сортировки постов(по просмотрам - VIEWS, по дате создания - CREATED)
- - from, не является обязательным, значение по умолчанию 0, используется для пагинации
- - size, не является обязательным, значение по умолчанию 10, используется для пагинации
#### При получении постов, у них увеличивается счетчик просмотров(views) на 1
#### Пример возвращаемого JSON c эндпоинтом /posts/filters?text=пост:
````
[
    {
        "id": 2,
        "title": "Название второго поста",
        "content": "Содержание второго тестового поста",
        "author": {
            "id": 2,
            "name": "Имя второго пользователя",
            "surname": "Фамилия второго пользователя"
        },
        "comments": [],
        "created": "2023-04-10T19:48:14.733182",
        "edited": false,
        "views": 4
    },
    {
        "id": 1,
        "title": "Название поста",
        "content": "Содержание тестового поста",
        "author": {
            "id": 1,
            "name": "Сергей",
            "surname": "Кашковский"
        },
        "comments": [],
        "created": "2023-04-10T19:12:04.765182",
        "edited": false,
        "views": 2
    }
]
````
#### Пример возвращаемого JSON с эндпоинтом /posts/filters?authors=1:
````
[
    {
        "id": 1,
        "title": "Название поста",
        "content": "Содержание тестового поста",
        "author": {
            "id": 1,
            "name": "Сергей",
            "surname": "Кашковский"
        },
        "comments": [],
        "created": "2023-04-10T19:12:04.765182",
        "edited": false,
        "views": 3
    }
]
````
#### Пример возвращаемого JSON с эндпоинтом /posts/filters?sort=CREATED (был добавлен третий пост для наглядности):
````
[
    {
        "id": 3,
        "title": "Название третьего поста",
        "content": "Содержание третьего тестового поста",
        "author": {
            "id": 3,
            "name": "Имя третьего пользователя",
            "surname": "Фамилия третьего пользователя"
        },
        "comments": [],
        "created": "2023-04-10T19:54:08.532471",
        "edited": false,
        "views": 1
    },
    {
        "id": 2,
        "title": "Название второго поста",
        "content": "Содержание второго тестового поста",
        "author": {
            "id": 2,
            "name": "Имя второго пользователя",
            "surname": "Фамилия второго пользователя"
        },
        "comments": [],
        "created": "2023-04-10T19:48:14.733182",
        "edited": false,
        "views": 4
    },
    {
        "id": 1,
        "title": "Название поста",
        "content": "Содержание тестового поста",
        "author": {
            "id": 1,
            "name": "Сергей",
            "surname": "Кашковский"
        },
        "comments": [],
        "created": "2023-04-10T19:12:04.765182",
        "edited": false,
        "views": 2
    }
]
````
___
## Комментарии
___
- ### Добавление комментариев
#### Эндпоинт: метод POST /posts/{id поста}/comments
- Используется хэдер X-Requester-Id для проверки отправителя запроса и присвоения автора комментарию
#### Используется валидация данных:
- Текст(text) комментария не может быть null или пустым(код ошибки 400 BAD REQUEST)
#### Если отправитель запроса или комментарий не найдены, то вернется ошибка 404 NOT FOUND
#### Пример JSON для добавления комментария:
````
{
    "text": "Текст комментария для первого поста"
}
````
#### Пример возвращаемого JSON:
````
{
    "id": 1,
    "postId": 1,
    "author": {
        "id": 1,
        "name": "Сергей",
        "surname": "Кашковский"
    },
    "text": "Текст комментария для первого поста",
    "created": "2023-04-10T22:21:54.700573284",
    "edited": false
}
````
___
- ### Изменение комментария
#### Эндпоинт: метод PATCH /comments/{id комментария}
- Используется хэдер X-Requester-Id для проверки отправителя запроса и автора комментария
#### Если отправитель запроса или комментарий не найдены, то вернется ошибка 404 NOT FOUND
#### Используется валидация данных как и при создании комментария
#### Изменить комментарий может только его автор, иначе возвращается ошибка 403 FORBIDDEN
#### При изменении комментария поле edited меняется на true
#### Пример JSON для изменения комментария:
````
{
    "text": "Новый текст комментария для первого поста"
}
````
#### Пример возвращаемого JSON:
````
{
    "id": 1,
    "postId": 1,
    "author": {
        "id": 1,
        "name": "Сергей",
        "surname": "Кашковский"
    },
    "text": "Новый текст комментария для первого поста",
    "created": "2023-04-10T22:21:54.700573284",
    "edited": true
}
````
___
- ### Удаление комментария
#### Эндпоинт: метод DELETE /comments/{id комментария}
- Используется хэдер X-Requester-Id для проверки отправителя запроса и автора комментария
#### Если отправитель запроса или комментарий не найдены, то вернется ошибка 404 NOT FOUND
#### Удалить комментарий может только его автор, иначе возврается ошибка 403 FORBIDDEN
#### Данный эндпоинт при успешном удалении возвращает только код 204 NO CONTENT
___
- ### Получение комментария по id
#### Эндпоинт: метод GET /comments/{id комментария}
#### Если комментарий не найден, то вернется ошибка 404 NOT FOUND
#### Пример возвращаемого JSON:
````
{
    "id": 1,
    "postId": 1,
    "author": {
        "id": 1,
        "name": "Сергей",
        "surname": "Кашковский"
    },
    "text": "Новый текст комментария для первого поста",
    "created": "2023-04-10T22:21:54.700573284",
    "edited": true
}
````
___
- ### Получение комментариев по id поста
#### Эндпоинт: метод GET /posts/{id поста}/comments
#### Если пост не найден, то вернется ошибка 404 NOT FOUND
#### Сортировка комментариев зависит от их даты создания(по убыванию)
#### Пример возвращаемого JSON:
````
[
    {
        "id": 2,
        "postId": 1,
        "author": {
            "id": 1,
            "name": "Сергей",
            "surname": "Кашковский"
        },
        "text": "Текст второго комментария к первому посту",
        "created": "2023-04-10T22:50:12.877742",
        "edited": false
    },
    {
        "id": 1,
        "postId": 1,
        "author": {
            "id": 1,
            "name": "Сергей",
            "surname": "Кашковский"
        },
        "text": "Новый текст комментария для первого поста",
        "created": "2023-04-10T22:21:54.700573",
        "edited": true
    }
]
````
#### Пример возвращаемого JSON поста с комментариями:
````
{
    "id": 1,
    "title": "Новое название поста",
    "content": "Содержание тестового поста",
    "author": {
        "id": 1,
        "name": "Новое имя",
        "surname": "Кашковский"
    },
    "comments": [
        {
            "id": 2,
            "postId": 1,
            "author": {
                "id": 1,
                "name": "Сергей",
                "surname": "Кашковский"
            },
            "text": "Текст второго комментария к первому посту",
            "created": "2023-04-10T22:50:12.877742",
            "edited": false
        },
        {
            "id": 1,
            "postId": 1,
            "author": {
                "id": 1,
                "name": "Сергей",
                "surname": "Кашковский"
            },
            "text": "Новый текст комментария для первого поста",
            "created": "2023-04-10T22:21:54.700573",
            "edited": true
        }
    ],
    "created": "2023-04-10T19:12:04.765182",
    "edited": true,
    "views": 6
}
````
___
- ### Примечание
#### При удалении пользователей, автоматически удаляются их посты и комментарии
#### При удалении постов, автоматически удаляются комментарии к ним
#### Для тестирования были добалены эндпоинты, которые удаляют данные из базы данных(с обновлением генерации id)
- Для пользователей: метод DELETE /users/debug
- Для постов: метод DELETE /posts/debug
- Для комментариев: метод DELETE /comments/debug
#### В репозитории имеется коллекция Postman тестов, которую можно импортировать и проверить работоспособность приложения
___
## Инструкции для сборки и запуска приложения
### Здесь будет описано 2 способа сборки и запуска приложения
___
### Начальный этап общий для обоих случаев - это сборка проекта:
- С помощью терминала перейти в корневую папка проекта
- Прописать команду mvn install(если Maven не установлен, то можно воспользоваться Maven Wrapper-ом и прописать mvnw install(в PowerShell может потребоваться прописать .\mvnw install))
___
### Запуск проекта с помощью Docker
- С помощью терминала перейти в корневую папку проекта
- Прописать команду docker compose up
___
### Запуск приложения без использования Docker
- С помощью терминала перейти в корневую папку проекта
- Прописать команду mvn spring-boot:run(если Maven не установлен, то можно воспользоваться Maven Wrapper-ом и прописать mvnw spring-boot:run(в PowerShell может потребоваться прописать .\mvnw spring-boot:run))
#### Для данного способа требуется PostgreSQL
- Название базы данных - test
- Порт - 5432
- Имя пользователя - test
- Пароль - test


